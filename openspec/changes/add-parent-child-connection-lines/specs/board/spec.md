## MODIFIED Requirements

### Requirement: 连接线自动管理

系统 SHALL 自动管理父子节点间的连接线，保持层级关系的可视化表达，并为通过SSE加载的数据和手动创建的节点提供一致的视觉体验。

#### Scenario: SSE数据加载时的连接线创建

- **WHEN** 通过SSE加载包含父子关系的Topic数据时
- **THEN** 必须为所有父子关系自动创建连接线
- **AND** 连接线必须使用基于层级的颜色样式（蓝色、绿色、橙色等）
- **AND** 连接线必须具有平滑的动画效果
- **AND** 连接线粗细应根据层级深度递减

#### Scenario: 递归层级计算和连接线样式

- **WHEN** 计算多层嵌套节点层级时
- **THEN** 必须递归计算父节点的层级来确定当前节点层级
- **AND** 顶级节点层级为0，每增加一层嵌套层级递增1
- **AND** 连接线颜色必须根据层级使用不同的主题色
- **AND** 层级越深的节点连接线越细

#### Scenario: 手动创建和SSE数据的连接线一致性

- **WHEN** 用户手动创建子节点或通过SSE加载Topic数据时
- **THEN** 两种方式创建的连接线样式必须完全一致
- **AND** 都必须使用相同的颜色方案和动画效果
- **AND** 都必须支持相同的交互行为（悬停效果等）

#### Scenario: 连接线路径优化和布局管理

- **WHEN** 存在多个同层级节点时
- **THEN** 连接线必须避免交叉和重叠
- **AND** 子节点位置必须相对于父节点智能计算
- **AND** 同一层级的多个子节点必须均匀分布
- **AND** 连接线必须使用平滑的曲线（smoothstep类型）

#### Scenario: 连接线状态管理和同步

- **WHEN** 节点数据通过SSE更新时
- **THEN** 连接线状态必须同步更新
- **AND** 如果父子关系发生变化，连接线必须自动重新创建
- **AND** 连接线的动画状态必须保持流畅
- **AND** 不能出现悬空的连接线或重复的连接线

## ADDED Requirements

### Requirement: 连接线样式和层级可视化

系统 SHALL 为不同层级的父子关系提供差异化的连接线样式，增强层级关系的可视化表达。

#### Scenario: 层级颜色方案

- **WHEN** 显示不同层级的连接线时
- **THEN** 层级0使用蓝色 (#3B82F6)
- **AND** 层级1使用绿色 (#10B981)
- **AND** 层级2使用橙色 (#F59E0B)
- **AND** 层级3使用红色 (#EF4444)
- **AND** 层级4使用紫色 (#8B5CF6)
- **AND** 更深层级循环使用这个颜色方案

#### Scenario: 连接线动画和交互效果

- **WHEN** 用户悬停在连接线上时
- **THEN** 连接线必须有轻微的加粗效果
- **AND** 连接线颜色可以有轻微的亮度变化
- **AND** 连接线的动画效果必须流畅且不干扰用户操作
- **AND** 连接线不能阻断其他交互元素的操作

#### Scenario: 连接线数据结构和性能优化

- **WHEN** 处理大量节点和连接线时
- **THEN** 连接线数据结构必须支持高效的查找和更新
- **AND** 连接线渲染不能显著影响画布性能
- **AND** 必须支持连接线的批量创建和删除
- **AND** 连接线的样式计算必须缓存优化，避免重复计算
