## Why

当前的数据库服务设计过于复杂，包含了许多不必要的 CRUD 操作。用户数据管理应该简化为：

1. 用户只需要在第一次填写用户名时自动创建记录，分配 UUID
2. 不需要复杂的用户查询、更新、删除操作
3. 测试用例反映了错误的设计方向，导致测试失败和维护困难

## What Changes

### 核心设计简化

- **用户数据简化**: 移除不必要的用户 CRUD 操作，只保留创建和获取当前用户
- **自动化处理**: 用户首次输入用户名时自动创建 UUID 并存储
- **测试重写**: 重新设计测试用例以反映简化的实际需求
- **API 简化**: 移除复杂的数据库操作接口，保留简单实用的方法

### 功能变更

- **用户创建**: 简化为一次性创建操作，自动生成 UUID
- **用户查询**: 只保留获取当前用户的操作
- **数据存储**: 保持 IndexedDB 存储但简化数据结构
- **错误处理**: 简化错误处理逻辑

### 测试策略调整

- **移除过度测试**: 删除不必要的 CRUD 测试用例
- **专注核心功能**: 测试用户创建和基本获取功能
- **简化 Mock**: 简化测试 Mock 实现
- **提高可维护性**: 测试用例与实际需求保持一致

## Impact

- **Affected specs**: data-storage（数据存储）、testing（测试规范）
- **Affected code**: src/database/database-service.ts、相关测试文件
- **简化复杂度**: 大幅减少数据库操作的复杂度
- **提高可维护性**: 更符合实际使用场景的设计

## Acceptance Criteria

### AC1: 简化的用户创建

- [ ] 用户首次输入用户名时自动创建带 UUID 的用户记录
- [ ] 用户创建是幂等操作，相同用户名不会重复创建
- [ ] 用户记录包含 UUID、用户名和创建时间

### AC2: 简化的用户获取

- [ ] 只提供获取当前登录用户的方法
- [ ] 移除通过 ID 或用户名查询用户的方法
- [ ] 支持从 IndexedDB 恢复当前用户状态

### AC3: 简化的数据结构

- [ ] 用户表只包含必要字段（id、username、createdAt）
- [ ] 移除不必要的更新和删除操作
- [ ] 保持与现有频道管理的兼容性

### AC4: 测试用例重写

- [ ] 移除过度设计的 CRUD 测试
- [ ] 只测试核心的用户创建和获取功能
- [ ] 测试用例通过率达到 100%
- [ ] 测试覆盖率达到项目标准（90%+）

### AC5: API 接口简化

- [ ] 移除复杂的 DatabaseService 接口
- [ ] 提供简单的用户创建和获取方法
- [ ] 保持与现有状态管理的兼容性
- [ ] 提供清晰的错误处理

## Risk Mitigation

### 风险1: 现有功能兼容性

- **缓解措施**: 保持与首页面和状态管理的接口兼容
- **监控指标**: 首页面功能正常工作，状态管理正常运行

### 风险2: 测试覆盖率下降

- **缓解措施**: 确保核心功能的测试覆盖，移除不必要的测试
- **监控指标**: 整体测试覆盖率保持在 90% 以上

### 风险3: 数据迁移复杂性

- **缓解措施**: 新设计与现有数据结构兼容，无需数据迁移
- **监控指标**: 现有用户数据继续正常工作

### 风险4: 开发流程中断

- **缓解措施**: 分阶段实施，先修复测试再重构实现
- **监控指标**: 开发环境稳定，测试通过率提升
