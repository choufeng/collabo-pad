## MODIFIED Requirements

### Requirement: 主题创建API坐标参数支持

系统 SHALL 扩展主题创建API，支持接收和处理可选的 x, y 坐标位置参数。

#### Scenario: API接收坐标参数

- **WHEN** 客户端调用主题创建API时
- **THEN** API必须支持接收可选的 x 和 y 坐标参数
- **AND** 坐标参数必须是数字类型，表示画布上的像素位置
- **AND** 坐标参数验证失败时不影响其他必需参数的处理
- **AND** API必须保持向后兼容性，坐标参数为可选

#### Scenario: 坐标参数验证和处理

- **WHEN** API接收到坐标参数时
- **THEN** 系统必须验证坐标值的有效性（非负数、合理范围内）
- **AND** 无效坐标必须被忽略或修正为默认值
- **AND** 坐标参数缺失时必须使用默认的位置计算逻辑
- **AND** 验证过程必须记录详细的日志用于调试

#### Scenario: 坐标信息存储到Redis Stream

- **WHEN** 创建包含坐标信息的主题时
- **THEN** 系统必须将 x, y 坐标存储到 Redis Stream 的主题数据中
- **AND** 坐标信息必须使用标准化的字段名（position_x, position_y）
- **AND** 坐标值必须以字符串形式存储以兼容 Redis Stream 格式
- **AND** 存储的坐标必须与主题的其他元数据一起保持一致性

#### Scenario: 主题数据结构扩展

- **WHEN** 定义包含坐标信息的主题数据时
- **THEN** Topic 接口必须扩展支持可选的 x, y 坐标字段
- **AND** CreateTopicRequest 接口必须包含可选的 x, y 参数
- **AND** 坐标字段必须有明确的类型定义和文档注释
- **AND** 类型定义必须支持向前兼容性

### Requirement: 基于坐标的主题位置管理

系统 SHALL 支持基于用户指定坐标的主题位置管理，提供精确的位置控制。

#### Scenario: 坐标位置主题创建

- **WHEN** 用户通过右键菜单在指定位置创建主题时
- **THEN** 系统必须在用户指定的 x, y 坐标处创建新主题节点
- **AND** 节点位置必须与右键点击位置精确对应
- **AND** 主题创建后的 SSE 通知必须包含位置信息
- **AND** 其他客户端必须能正确显示带位置信息的主题

#### Scenario: 缺失坐标时的默认处理

- **WHEN** 主题创建请求没有提供坐标信息时
- **THEN** 系统必须使用默认的位置计算算法
- **AND** 默认位置必须考虑现有节点的分布避免重叠
- **AND** 默认位置必须使用随机或智能布局算法
- **AND** 必须确保所有主题都有有效的位置信息

#### Scenario: 坐标信息查询和过滤

- **WHEN** 查询特定频道的主题数据时
- **THEN** 系统必须返回包含坐标信息的完整主题数据
- **AND** 坐标信息必须与其他主题数据一起序列化
- **AND** 查询结果必须支持基于位置的范围过滤
- **AND** 坐标信息必须用于客户端的节点定位

#### Scenario: 坐标精度和边界处理

- **WHEN** 处理主题坐标信息时
- **THEN** 系统必须保持坐标的精度到像素级别
- **AND** 负坐标或超大坐标必须进行合理的边界检查
- **AND** 坐标超出画布边界时必须自动调整到可见区域
- **AND** 坐标计算必须考虑不同设备的像素密度

### Requirement: 实时SSE推送坐标信息

系统 SHALL 通过SSE实时推送包含坐标信息的主题数据，确保所有客户端同步显示。

#### Scenario: 坐标信息SSE推送

- **WHEN** 新主题被创建并包含坐标信息时
- **THEN** SSE推送消息必须包含完整的主题数据和坐标位置
- **AND** 推送消息格式必须保持与现有SSE消息的兼容性
- **AND** 坐标信息必须正确解析和处理
- **AND** 接收端必须能根据坐标信息正确渲染节点位置

#### Scenario: 历史数据坐标信息处理

- **WHEN** 客户端首次连接SSE获取历史数据时
- **THEN** 系统必须推送包含坐标信息的所有历史主题
- **AND** 缺失坐标的历史主题必须使用默认位置
- **AND** 坐标信息必须帮助正确重建画布布局
- **AND** 历史数据的坐标处理必须高效完成

#### Scenario: 坐标信息冲突处理

- **WHEN** 多个客户端同时创建位置相近的主题时
- **THEN** 系统必须检测并处理潜在的坐标冲突
- **AND** 冲突的主题位置必须自动微调避免完全重叠
- **AND** 位置调整必须保持用户意图的位置语义
- **AND** 冲突处理过程必须对所有客户端保持一致
