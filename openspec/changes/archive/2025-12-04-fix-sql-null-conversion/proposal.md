# 修复SQL参数空值转换

## 提案概述

本提案旨在修复后端代码中的空值处理问题，确保在构建SQL/NoSQL参数数组时，将空值 (`""`, `undefined`) 正确转换为数据库可接受的 `null` 值。

## 问题背景

当前代码库中存在以下问题：

- Redis Stream 操作使用 `Object.entries(data).flat()` 构建参数数组时，空字符串会被直接传递给Redis
- API 接收的空值参数可能需要显式转换为 null 才能被数据库正确处理
- 某些可选字段（如尺寸、坐标、元数据）的空值处理不一致

## 解决方案

创建一个统一的空值转换工具函数，在所有数据持久化操作前进行标准化处理。

## 影响范围

- `src/lib/redis.ts` - Redis Stream 参数处理
- `src/services/TopicService.ts` - 数据库操作预处理
- 相关 API 路由的数据验证层

## 预期收益

- 提高数据一致性，避免空字符串导致的数据库约束错误
- 统一空值处理逻辑，减少代码重复
- 增强应用程序的健壮性

## 实现策略

1. 创建 `toNull()` 辅助函数
2. 在所有数据持久化点应用该函数
3. 添加单元测试验证转换逻辑
4. 更新相关 API 文档

## 验证标准

- 所有空字符串和 undefined 值在存储前转为 null
- 现有功能不受影响
- 测试覆盖率达到 100%
