## 1. 问题分析和修复

- [x] 1.1 分析当前 `optimizeNodePositions` 函数如何覆盖已有坐标
- [x] 1.2 识别需要修改的具体代码位置
- [x] 1.3 设计坐标保护逻辑，确保有坐标的节点不被重新定位
- [x] 1.4 实现位置优化函数的条件性执行

## 2. 节点位置优化算法改进

- [x] 2.1 修改 `optimizeNodePositions` 函数，添加坐标检查逻辑
- [x] 2.2 确保只有没有 position_x, position_y 的节点参与优化
- [x] 2.3 实现有坐标节点与无坐标节点的混合布局
- [x] 2.4 优化算法性能，避免不必要的计算

## 3. 测试覆盖

- [x] 3.1 为修改后的位置优化函数编写单元测试
- [x] 3.2 测试混合坐标场景（部分有坐标，部分无坐标）
- [x] 3.3 测试边界情况（坐标为 0, undefined, null）
- [x] 3.4 验证多节点布局不出现重叠
- [x] 3.5 集成测试：验证完整的数据流（Redis -> 界面）

## 4. 用户体验验证

- [x] 4.1 验证右键菜单创建的主题位置保持稳定
- [x] 4.2 验证界面刷新/重新加载时坐标不丢失
- [x] 4.3 验证 SSE 实时更新时坐标信息正确同步
- [x] 4.4 测试大量主题时的布局性能
- [x] 4.5 验证向后兼容性（老数据正常显示）

## 5. 代码质量保证

- [x] 5.1 添加 JSDoc 注释说明坐标保护逻辑
- [x] 5.2 确保 TypeScript 类型安全
- [x] 5.3 运行 ESLint 检查代码风格
- [x] 5.4 运行现有测试套件确保无回归
- [x] 5.5 性能基准测试，确保优化不影响性能
