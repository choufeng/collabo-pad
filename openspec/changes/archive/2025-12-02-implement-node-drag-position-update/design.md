## Context

当前系统已经支持节点的拖拽移动（ReactFlow内置功能），但位置变化只在前端状态中保存，没有持久化到数据库。用户拖动节点后，如果刷新页面或重新访问，节点会回到原来的位置。现有的 `/api/topics/update` API 已经支持更新节点的x、y坐标，只需要在拖动结束时调用该API即可。

## Goals / Non-Goals

### Goals

- 实现节点拖动位置的自动保存功能
- 提供良好的用户体验和视觉反馈
- 合理控制API调用频率，避免性能问题
- 优雅处理网络错误和失败情况

### Non-Goals

- 重新设计整个拖动系统（使用ReactFlow内置功能）
- 实现复杂的位置历史记录和撤销功能
- 添加拖动动画效果（超出简单需求）
- 实现批量位置更新功能

## Decisions

### API调用策略

- **决策：** 使用防抖机制，在拖动结束后延迟300ms再调用API
- **理由：** 避免频繁调用，同时确保及时保存
- **替代方案：** 立即调用（性能开销大）或仅释放鼠标时调用（可能丢失最后调整）

### 错误处理策略

- **决策：** 保存失败时不恢复原位置，但显示错误提示
- **理由：** 用户体验更重要，错误提示告知用户可手动调整
- **替代方案：** 自动回滚位置（用户困惑）或静默失败（数据不一致）

### 性能优化策略

- **决策：** 只在位置实际发生变化时才调用API
- **理由：** 避免无效的网络请求
- **替代方案：** 每次拖动结束都调用（浪费资源）

## Risks / Trade-offs

### 网络延迟风险

- **风险：** 拖动后API调用可能延迟，用户可能认为保存失败
- **缓解：** 添加保存状态指示器，显示"正在保存..."状态

### API频率风险

- **风险：** 频繁拖动可能导致过多API调用
- **缓解：** 使用防抖机制和位置变化检测

### 并发操作风险

- **风险：** 多个用户同时拖动节点可能导致冲突
- **缓解：** 采用后写入者胜出策略，这是常见做法

## Migration Plan

### 阶段1：基础功能实现

1. 在Board组件中添加onNodeDragEnd事件处理
2. 实现位置变化检测逻辑
3. 集成topics/update API调用

### 阶段2：用户体验优化

1. 添加防抖机制
2. 实现错误处理和用户反馈
3. 添加保存状态指示

### 阶段3：测试和验证

1. 编写相关测试用例
2. 进行性能测试
3. 验证边界条件处理

## Open Questions

- 是否需要支持节点位置的批量更新？
- 拖动过程中的网络中断如何处理？
- 是否需要添加位置更新的撤销功能？
- 如何处理长时间拖动操作的性能问题？
